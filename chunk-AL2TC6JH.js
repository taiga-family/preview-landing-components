import{Aa as re,Ia as oe,La as se,M,Pa as ce,Y as ne,e as te,eb as he}from"./chunk-RTG4UHW5.js";import{Ab as y,Dc as C,Ea as L,Eb as g,Fa as V,Fb as _,Gb as I,Ha as E,J as B,Jc as ee,Ka as h,Kb as Y,Ma as b,Nb as d,Ob as Z,Pb as J,Pc as w,Qb as K,bc as F,ca as k,dc as j,eb as G,ec as Q,gb as m,ib as p,ja as a,jb as s,la as D,mb as X,md as x,nd as ie,rc as $,tb as f,ua as R,va as u,wa as l,wb as q,xb as A,yb as c,zb as v}from"./chunk-LMVIBKMN.js";import{$a as le,E as S,Va as ue,_a as de,t as ae}from"./chunk-JWNVKOIN.js";var me=(()=>{class t{constructor({nativeElement:e}){return new h(e)}}return t.\u0275fac=function(e){return new(e||t)(s(h))},t.\u0275dir=l({type:t,selectors:[["","tuiElement",""]],exportAs:["elementRef"]}),t})();var pe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({}),t})();var W=(()=>{class t extends me{}return t.\u0275fac=(()=>{let n;return function(i){return(n||(n=E(t)))(i||t)}})(),t.\u0275dir=l({type:t,selectors:[["","tuiResizeable",""]],features:[f]}),t})(),ge=(()=>{class t{constructor(e){this.resizeable=e,this.tuiResizer=[0,0],this.tuiSizeChange=new b,this.x=NaN,this.y=NaN,this.width=0,this.height=0}get cursor(){return this.tuiResizer[0]?this.tuiResizer[1]?this.tuiResizer[0]*this.tuiResizer[1]>0?"nwse-resize":"nesw-resize":"ew-resize":"ns-resize"}onTouchStart({touches:e}){this.onMouseDown(e[0].clientX,e[0].clientY)}onMouseDown(e,i){this.x=e,this.y=i,this.width=this.resizeable.nativeElement.clientWidth,this.height=this.resizeable.nativeElement.clientHeight}onMouseMove({x:e,y:i,buttons:r}){r?this.onMove(e,i):this.onMouseUp()}onTouchMove({touches:e}){this.onMove(e[0].clientX,e[0].clientY)}onMouseUp(){this.x=NaN}onMove(e,i){if(Number.isNaN(this.x))return;let{style:r}=this.resizeable.nativeElement,o=[this.width+this.tuiResizer[0]*(e-this.x),this.height+this.tuiResizer[1]*(i-this.y)];this.tuiResizer[0]&&(r.width=M(o[0])),this.tuiResizer[1]&&(r.height=M(o[1])),this.tuiSizeChange.emit(o)}}return t.\u0275fac=function(e){return new(e||t)(s(W))},t.\u0275dir=l({type:t,selectors:[["","tuiResizer",""]],hostVars:4,hostBindings:function(e,i){e&1&&d("touchstart.silent.passive",function(o){return i.onTouchStart(o)})("mousedown.silent.prevent",function(o){return i.onMouseDown(o.x,o.y)})("mousemove.silent",function(o){return i.onMouseMove(o)},!1,m)("touchmove.silent",function(o){return i.onTouchMove(o)},!1,m)("mouseup.silent",function(){return i.onMouseUp()},!1,m)("touchend.silent",function(){return i.onMouseUp()},!1,m),e&2&&v("touch-action","none")("cursor",i.cursor)},inputs:{tuiResizer:"tuiResizer"},outputs:{tuiSizeChange:"tuiSizeChange"}}),t})(),fe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({}),t})();var U=class{constructor(n,e,i){let r=e.get($),z=e.get(X).resolveComponentFactory(n);this.componentRef=z.create(e,[]),this.updateProps(i),r.attachView(this.componentRef.hostView)}get instance(){return this.componentRef.instance}get el(){return this.componentRef.injector.get(h)}get dom(){return this.el.nativeElement}updateProps(n){Object.entries(n).forEach(([e,i])=>{this.instance[e]=i})}detectChanges(){this.componentRef.changeDetectorRef.detectChanges()}destroy(){this.componentRef.destroy()}},H=class{},P=class extends le{constructor(){super(...arguments),this.contentDOMElement=null}mount(){let n=this.options.injector,e=n.get(C),i={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(r={})=>this.updateAttributes(r),deleteNode:()=>this.deleteNode()};this.editor.on("selectionUpdate",this.handleSelectionUpdate.bind(this)),this.renderer=new U(this.component,n,i),this.extension.config.draggable&&(this.renderer.el.nativeElement.ondragstart=r=>{this.onDragStart(r)}),this.contentDOMElement=this.node.isLeaf?null:e.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit",this.renderer.detectChanges()),this.appendContendDom()}get dom(){return this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}update(n,e){return this.options.update?this.options.update(n,e):n.type!==this.node.type?!1:(n===this.node&&this.decorations===e||(this.node=n,this.decorations=e,this.renderer.updateProps({node:n,decorations:e}),this.appendContendDom()),!0)}handleSelectionUpdate(){let{from:n,to:e}=this.editor.state.selection;n<=this.getPos()&&e>=this.getPos()+this.node.nodeSize?this.selectNode():this.deselectNode()}selectNode(){this.renderer.updateProps({selected:!0})}deselectNode(){this.renderer.updateProps({selected:!1})}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate.bind(this)),this.contentDOMElement=null}appendContendDom(){let n=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&n&&!n.contains(this.contentDOMElement)&&n.appendChild(this.contentDOMElement)}};var Ee=["*"],be=t=>[t,0],ye=()=>[1,0],Ie=()=>[0,1];function Ce(t,n){if(t&1){let e=Y();g(0,"div",4),d("tuiSizeChange",function(r){L(e);let o=Z();return V(o.sizeChange.emit(r))}),_()}t&2&&c("tuiResizer",j(1,Ie))}var ve=(()=>{class t extends H{constructor(){super(...arguments),this.currentHeight=0,this.currentWidth=0}get attrs(){var e;return((e=this.node)===null||e===void 0?void 0:e.attrs)||{src:""}}get width(){return this.currentWidth||this.attrs.width||null}get height(){return this.currentHeight||this.attrs.height||null}}return t.\u0275fac=(()=>{let n;return function(i){return(n||(n=E(t)))(i||t)}})(),t.\u0275dir=l({type:t,features:[f]}),t})(),_e=(()=>{class t{constructor(){this.autoHeight=!1,this.width=null,this.height=null,this.sizeChange=new b}get hostWidth(){return x(this.width)?M(this.width):this.width}get hostHeight(){return this.autoHeight?null:x(this.height)?M(this.height):this.height}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=R({type:t,selectors:[["tui-editor-resizable"]],hostVars:4,hostBindings:function(e,i){e&2&&v("width",i.hostWidth)("height",i.hostHeight)},inputs:{autoHeight:"autoHeight",width:"width",height:"height"},outputs:{sizeChange:"sizeChange"},ngContentSelectors:Ee,decls:5,vars:8,consts:[["tuiResizeable","",1,"t-resizable"],[1,"t-handle","t-handle-left-side",3,"tuiSizeChange","tuiResizer"],["class","t-handle t-handle-bottom-side",3,"tuiResizer","tuiSizeChange",4,"ngIf"],[1,"t-handle","t-handle-right-side",3,"tuiSizeChange","tuiResizer"],[1,"t-handle","t-handle-bottom-side",3,"tuiSizeChange","tuiResizer"]],template:function(e,i){e&1&&(J(),g(0,"div",0),K(1),g(2,"div",1),d("tuiSizeChange",function(o){return i.sizeChange.emit(o)}),_(),q(3,Ce,1,2,"div",2),g(4,"div",3),d("tuiSizeChange",function(o){return i.sizeChange.emit(o)}),_()()),e&2&&(y("t-resizable-auto-height",i.autoHeight),p(2),c("tuiResizer",Q(5,be,-1)),p(),c("ngIf",!i.autoHeight),p(),c("tuiResizer",j(7,ye)))},dependencies:[W,ge,ee],styles:['[_nghost-%COMP%]{position:relative;display:inline-block;box-sizing:border-box}[_nghost-%COMP%]   .t-resizable[_ngcontent-%COMP%]{box-sizing:border-box}[_nghost-%COMP%]   .t-resizable-auto-height[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   iframe[_ngcontent-%COMP%]{display:inline;pointer-events:none}[_nghost-%COMP%]:hover   .t-handle[_ngcontent-%COMP%]:after{opacity:1}.t-handle[_ngcontent-%COMP%]{position:absolute;top:0;display:flex;width:.75rem;cursor:col-resize;justify-content:center;align-items:center;height:100%}.t-handle[_ngcontent-%COMP%]:after{transition-property:opacity;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;content:"";width:50%;height:33%;box-sizing:border-box;border-radius:var(--tui-radius-m);background:var(--tui-base-08);border:1px solid var(--tui-base-03);opacity:0}.t-handle-left-side[_ngcontent-%COMP%]{left:0}.t-handle-bottom-side[_ngcontent-%COMP%]{top:unset;bottom:.3125rem;height:.95rem;width:100%}.t-handle-right-side[_ngcontent-%COMP%]{right:0}'],changeDetection:0}),t})(),Me=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({imports:[[w,pe,fe]]}),t})();var Se=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,ze=de.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",S(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:n})=>n.insertContent({type:this.name,attrs:t})}},addInputRules(){return[ue({find:Se,type:this.type,getAttributes:t=>{let[,,n,e,i]=t;return{src:e,alt:n,title:i}}})]}});var Oe=new D("[TUI_EDITOR_MIN_IMAGE_WIDTH]",{factory:()=>null}),He=new D("[TUI_EDITOR_MAX_IMAGE_WIDTH]",{factory:()=>null}),Pe=new D("[TUI_IMAGE_EDITOR_OPTIONS]",{factory:()=>({minWidth:null,maxWidth:1/0})}),Ne=(()=>{class t extends ve{constructor(e,i,r,o,z,T,N){super(),this.legacyMinWidth=e,this.legacyMaxWidth=i,this.options=r,this.doc=o,this.sanitizer=z,this.el=T,this.win=N,this.contenteditable=!0,this.focused=!1}get dragHandle(){var e;return(e=this.attrs.draggable)!==null&&e!==void 0?e:null}get height(){return null}get alt(){return this.attrs.alt||""}get title(){return this.attrs.title||""}get src(){return this.sanitizer.bypassSecurityTrustResourceUrl(this.attrs.src)}getSrc(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e??"")}currentTargetIsFocused(e){this.focused=this.el.nativeElement.contains(e),this.focused&&this.selectFakeText()}get minWidth(){var e;return((e=this.legacyMinWidth)!==null&&e!==void 0?e:this.options.minWidth)||0}get maxWidth(){var e;return((e=this.legacyMaxWidth)!==null&&e!==void 0?e:this.options.maxWidth)||0}updateSize([e]){this.currentWidth=Math.max(this.minWidth,Math.min(this.maxWidth,e)),this.attrs.width=this.currentWidth,this.el.nativeElement.dispatchEvent(new CustomEvent(ce,{bubbles:!0}))}selectFakeText(){var e,i,r;let o=this.doc.createRange();(e=this.el.nativeElement.querySelector("p"))===null||e===void 0||e.focus(),o.selectNode(this.el.nativeElement),(i=this.win.getSelection())===null||i===void 0||i.removeAllRanges(),(r=this.win.getSelection())===null||r===void 0||r.addRange(o)}}return t.\u0275fac=function(e){return new(e||t)(s(Oe),s(He),s(Pe),s(C),s(te),s(h),s(ne))},t.\u0275cmp=R({type:t,selectors:[["tui-image-editor"]],hostVars:2,hostBindings:function(e,i){e&1&&d("click.silent",function(o){return i.currentTargetIsFocused(o.target)},!1,m),e&2&&A("contenteditable",i.contenteditable)("data-drag-handle",i.dragHandle)},features:[F([re]),f],decls:4,vars:12,consts:[["contenteditable","false",1,"t-emulate-inline-node"],[3,"sizeChange","autoHeight","width"],["contenteditable","false",3,"alt","src","title"]],template:function(e,i){e&1&&(I(0,"p",0),g(1,"tui-editor-resizable",1),d("sizeChange",function(o){return i.updateSize(o)}),I(2,"img",2),_(),I(3,"p",0)),e&2&&(p(),c("autoHeight",!0)("width",i.width),p(),v("max-width",i.maxWidth,"px")("min-width",i.minWidth,"px"),y("ProseMirror-selectednode",i.focused),c("alt",i.alt)("src",i.getSrc(i.attrs.src),G)("title",i.title),A("width",i.width))},dependencies:[_e],styles:["[data-drag-handle][_nghost-%COMP%]{cursor:move}img[_ngcontent-%COMP%]{pointer-events:none}.t-emulate-inline-node[_ngcontent-%COMP%]{display:inline-block;margin:0;height:0}"],changeDetection:0}),se([oe],t.prototype,"getSrc",null),t})(),Ae=[{tag:"img"}],Fe={src:{default:"",keepOnSplit:!1},width:{default:null,keepOnSplit:!1},alt:{default:"",keepOnSplit:!1},title:{default:"",keepOnSplit:!1}};function Te(t){return(n,e)=>{var i;let r=e instanceof DragEvent?e.dataTransfer:e.clipboardData,o=Array.from((i=r==null?void 0:r.files)!==null&&i!==void 0?i:[]).filter(T=>/image/i.test(T.type));o.length&&e.preventDefault();let z=t.get(he);o.forEach(T=>{z(T).pipe(B(1),k(()=>!n.isDestroyed)).subscribe(N=>{let De=n.state.schema.nodes.image.create({src:N}),Re=n.state.tr.replaceSelectionWith(De);setTimeout==null||setTimeout(()=>{n.isDestroyed||n.dispatch(Re)})})})}}function Ut({injector:t,draggable:n}){return je(t,{draggable:n})}function je(t,{draggable:n}={}){let e=ie(n)?n:!0;return ze.extend({name:"image",group:"inline",inline:!0,atom:!0,priority:0,selectable:!0,draggable:e,parseHTML(){return Ae},addAttributes(){return Object.assign(Object.assign({},Fe),{draggable:{default:e?"":null,keepOnSplit:!1}})},renderHTML({HTMLAttributes:i}){return["img",S(i)]},addNodeView(){return i=>Reflect.construct(P,[Ne,i,Object.assign({injector:t},i)])},addCommands(){return{setEditableImage:i=>({commands:r})=>r.insertContent({type:this.name,attrs:i})}},addProseMirrorPlugins(){return[new ae({props:{handleDOMEvents:{paste:Te(t),drop:Te(t)}}})]}})}var Bt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({imports:[[w,Me]]}),t})();export{He as TUI_EDITOR_MAX_IMAGE_WIDTH,Oe as TUI_EDITOR_MIN_IMAGE_WIDTH,Pe as TUI_IMAGE_EDITOR_OPTIONS,Ne as TuiImageEditorComponent,Bt as TuiImageEditorModule,je as createImageEditorExtension,Ut as tuiCreateImageEditorExtension};
//# sourceMappingURL=chunk-AL2TC6JH.js.map
