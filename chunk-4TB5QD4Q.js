import{B as j,E as we,Xa as be,a as y,b as S,g as R,h as N,k as ue,l as v,m as he,n as x,o as pe,q as $,qa as Ce,r as W,s as I,t as L,u as me,x as ge}from"./chunk-GOOAHOWT.js";var ee,te;if(typeof WeakMap<"u"){let t=new WeakMap;ee=e=>t.get(e),te=(e,o)=>(t.set(e,o),o)}else{let t=[],o=0;ee=n=>{for(let l=0;l<t.length;l+=2)if(t[l]==n)return t[l+1]},te=(n,l)=>(o==10&&(o=0),t[o++]=n,t[o++]=l)}var C=class{constructor(t,e,o,n){this.width=t,this.height=e,this.map=o,this.problems=n}findCell(t){for(let e=0;e<this.map.length;e++){let o=this.map[e];if(o!=t)continue;let n=e%this.width,l=e/this.width|0,r=n+1,s=l+1;for(let a=1;r<this.width&&this.map[e+a]==o;a++)r++;for(let a=1;s<this.height&&this.map[e+this.width*a]==o;a++)s++;return{left:n,top:l,right:r,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,o){let{left:n,right:l,top:r,bottom:s}=this.findCell(t);return e=="horiz"?(o<0?n==0:l==this.width)?null:this.map[r*this.width+(o<0?n-1:l)]:(o<0?r==0:s==this.height)?null:this.map[n+this.width*(o<0?r-1:s)]}rectBetween(t,e){let{left:o,right:n,top:l,bottom:r}=this.findCell(t),{left:s,right:a,top:i,bottom:c}=this.findCell(e);return{left:Math.min(o,s),top:Math.min(l,i),right:Math.max(n,a),bottom:Math.max(r,c)}}cellsInRect(t){let e=[],o={};for(let n=t.top;n<t.bottom;n++)for(let l=t.left;l<t.right;l++){let r=n*this.width+l,s=this.map[r];o[s]||(o[s]=!0,!(l==t.left&&l&&this.map[r-1]==s||n==t.top&&n&&this.map[r-this.width]==s)&&e.push(s))}return e}positionAt(t,e,o){for(let n=0,l=0;;n++){let r=l+o.child(n).nodeSize;if(n==t){let s=e+t*this.width,a=(t+1)*this.width;for(;s<a&&this.map[s]<l;)s++;return s==a?r-1:this.map[s]}l=r}}static get(t){return ee(t)||te(t,Ye(t))}};function Ye(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);let e=Ge(t),o=t.childCount,n=[],l=0,r=null,s=[];for(let c=0,d=e*o;c<d;c++)n[c]=0;for(let c=0,d=0;c<o;c++){let f=t.child(c);d++;for(let p=0;;p++){for(;l<n.length&&n[l]!=0;)l++;if(p==f.childCount)break;let m=f.child(p),{colspan:g,rowspan:b,colwidth:fe}=m.attrs;for(let P=0;P<b;P++){if(P+c>=o){(r||(r=[])).push({type:"overlong_rowspan",pos:d,n:b-P});break}let G=l+P*e;for(let D=0;D<g;D++){n[G+D]==0?n[G+D]=d:(r||(r=[])).push({type:"collision",row:c,pos:d,n:g-D});let O=fe&&fe[D];if(O){let F=(G+D)%e*2,Q=s[F];Q==null||Q!=O&&s[F+1]==1?(s[F]=O,s[F+1]=1):Q==O&&s[F+1]++}}}l+=g,d+=m.nodeSize}let u=(c+1)*e,h=0;for(;l<u;)n[l++]==0&&h++;h&&(r||(r=[])).push({type:"missing",row:c,n:h}),d++}let a=new C(e,o,n,r),i=!1;for(let c=0;!i&&c<s.length;c+=2)s[c]!=null&&s[c+1]<o&&(i=!0);return i&&Qe(a,s,t),a}function Ge(t){let e=-1,o=!1;for(let n=0;n<t.childCount;n++){let l=t.child(n),r=0;if(o)for(let s=0;s<n;s++){let a=t.child(s);for(let i=0;i<a.childCount;i++){let c=a.child(i);s+c.attrs.rowspan>n&&(r+=c.attrs.colspan)}}for(let s=0;s<l.childCount;s++){let a=l.child(s);r+=a.attrs.colspan,a.attrs.rowspan>1&&(o=!0)}e==-1?e=r:e!=r&&(e=Math.max(e,r))}return e}function Qe(t,e,o){t.problems||(t.problems=[]);let n={};for(let l=0;l<t.map.length;l++){let r=t.map[l];if(n[r])continue;n[r]=!0;let s=o.nodeAt(r);if(!s)throw new RangeError(`No cell with offset ${r} found`);let a=null,i=s.attrs;for(let c=0;c<i.colspan;c++){let d=(l+c)%t.width,f=e[d*2];f!=null&&(!i.colwidth||i.colwidth[c]!=f)&&((a||(a=Ze(i)))[c]=f)}a&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}function Ze(t){if(t.colwidth)return t.colwidth.slice();let e=[];for(let o=0;o<t.colspan;o++)e.push(0);return e}function A(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(let o in t.nodes){let n=t.nodes[o],l=n.spec.tableRole;l&&(e[l]=n)}}return e}var E=new W("selectingCells");function _(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function et(t){for(let e=t.depth;e>0;e--){let o=t.node(e).type.spec.tableRole;if(o==="cell"||o==="header_cell")return t.node(e)}return null}function T(t){let e=t.selection.$head;for(let o=e.depth;o>0;o--)if(e.node(o).type.spec.tableRole=="row")return!0;return!1}function U(t){let e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;let o=_(e.$head)||tt(e.$head);if(o)return o;throw new RangeError(`No cell found around position ${e.head}`)}function tt(t){for(let e=t.nodeAfter,o=t.pos;e;e=e.firstChild,o++){let n=e.type.spec.tableRole;if(n=="cell"||n=="header_cell")return t.doc.resolve(o)}for(let e=t.nodeBefore,o=t.pos;e;e=e.lastChild,o--){let n=e.type.spec.tableRole;if(n=="cell"||n=="header_cell")return t.doc.resolve(o-e.nodeSize)}}function oe(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function ot(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function re(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Te(t,e,o){let n=t.node(-1),l=C.get(n),r=t.start(-1),s=l.nextCell(t.pos-r,e,o);return s==null?null:t.node(0).resolve(r+s)}function H(t,e,o=1){let n=S(y({},t),{colspan:t.colspan-o});return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(e,o),n.colwidth.some(l=>l>0)||(n.colwidth=null)),n}function ze(t,e,o=1){let n=S(y({},t),{colspan:t.colspan+o});if(n.colwidth){n.colwidth=n.colwidth.slice();for(let l=0;l<o;l++)n.colwidth.splice(e,0,0)}return n}function nt(t,e,o){let n=A(e.type.schema).header_cell;for(let l=0;l<t.height;l++)if(e.nodeAt(t.map[o+l*t.width]).type!=n)return!1;return!0}var w=class k extends v{constructor(e,o=e){let n=e.node(-1),l=C.get(n),r=e.start(-1),s=l.rectBetween(e.pos-r,o.pos-r),a=e.node(0),i=l.cellsInRect(s).filter(d=>d!=o.pos-r);i.unshift(o.pos-r);let c=i.map(d=>{let f=n.nodeAt(d);if(!f)throw RangeError(`No cell with offset ${d} found`);let u=r+d+1;return new he(a.resolve(u),a.resolve(u+f.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=o}map(e,o){let n=e.resolve(o.map(this.$anchorCell.pos)),l=e.resolve(o.map(this.$headCell.pos));if(oe(n)&&oe(l)&&re(n,l)){let r=this.$anchorCell.node(-1)!=n.node(-1);return r&&this.isRowSelection()?k.rowSelection(n,l):r&&this.isColSelection()?k.colSelection(n,l):new k(n,l)}return x.between(n,l)}content(){let e=this.$anchorCell.node(-1),o=C.get(e),n=this.$anchorCell.start(-1),l=o.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),r={},s=[];for(let i=l.top;i<l.bottom;i++){let c=[];for(let d=i*o.width+l.left,f=l.left;f<l.right;f++,d++){let u=o.map[d];if(r[u])continue;r[u]=!0;let h=o.findCell(u),p=e.nodeAt(u);if(!p)throw RangeError(`No cell with offset ${u} found`);let m=l.left-h.left,g=h.right-l.right;if(m>0||g>0){let b=p.attrs;if(m>0&&(b=H(b,0,m)),g>0&&(b=H(b,b.colspan-g,g)),h.left<l.left){if(p=p.type.createAndFill(b),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(b)}`)}else p=p.type.create(b,p.content)}if(h.top<l.top||h.bottom>l.bottom){let b=S(y({},p.attrs),{rowspan:Math.min(h.bottom,l.bottom)-Math.max(h.top,l.top)});h.top<l.top?p=p.type.createAndFill(b):p=p.type.create(b,p.content)}c.push(p)}s.push(e.child(i).copy(R.from(c)))}let a=this.isColSelection()&&this.isRowSelection()?e:s;return new N(R.from(a),1,1)}replace(e,o=N.empty){let n=e.steps.length,l=this.ranges;for(let s=0;s<l.length;s++){let{$from:a,$to:i}=l[s],c=e.mapping.slice(n);e.replace(c.map(a.pos),c.map(i.pos),s?N.empty:o)}let r=v.findFrom(e.doc.resolve(e.mapping.slice(n).map(this.to)),-1);r&&e.setSelection(r)}replaceWith(e,o){this.replace(e,new N(R.from(o),0,0))}forEachCell(e){let o=this.$anchorCell.node(-1),n=C.get(o),l=this.$anchorCell.start(-1),r=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-l,this.$headCell.pos-l));for(let s=0;s<r.length;s++)e(o.nodeAt(r[s]),l+r[s])}isColSelection(){let e=this.$anchorCell.index(-1),o=this.$headCell.index(-1);if(Math.min(e,o)>0)return!1;let n=e+this.$anchorCell.nodeAfter.attrs.rowspan,l=o+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,l)==this.$headCell.node(-1).childCount}static colSelection(e,o=e){let n=e.node(-1),l=C.get(n),r=e.start(-1),s=l.findCell(e.pos-r),a=l.findCell(o.pos-r),i=e.node(0);return s.top<=a.top?(s.top>0&&(e=i.resolve(r+l.map[s.left])),a.bottom<l.height&&(o=i.resolve(r+l.map[l.width*(l.height-1)+a.right-1]))):(a.top>0&&(o=i.resolve(r+l.map[a.left])),s.bottom<l.height&&(e=i.resolve(r+l.map[l.width*(l.height-1)+s.right-1]))),new k(e,o)}isRowSelection(){let e=this.$anchorCell.node(-1),o=C.get(e),n=this.$anchorCell.start(-1),l=o.colCount(this.$anchorCell.pos-n),r=o.colCount(this.$headCell.pos-n);if(Math.min(l,r)>0)return!1;let s=l+this.$anchorCell.nodeAfter.attrs.colspan,a=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,a)==o.width}eq(e){return e instanceof k&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,o=e){let n=e.node(-1),l=C.get(n),r=e.start(-1),s=l.findCell(e.pos-r),a=l.findCell(o.pos-r),i=e.node(0);return s.left<=a.left?(s.left>0&&(e=i.resolve(r+l.map[s.top*l.width])),a.right<l.width&&(o=i.resolve(r+l.map[l.width*(a.top+1)-1]))):(a.left>0&&(o=i.resolve(r+l.map[a.top*l.width])),s.right<l.width&&(e=i.resolve(r+l.map[l.width*(s.top+1)-1]))),new k(e,o)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,o){return new k(e.resolve(o.anchor),e.resolve(o.head))}static create(e,o,n=o){return new k(e.resolve(o),e.resolve(n))}getBookmark(){return new lt(this.$anchorCell.pos,this.$headCell.pos)}};w.prototype.visible=!1;v.jsonID("cell",w);var lt=class ke{constructor(e,o){this.anchor=e,this.head=o}map(e){return new ke(e.map(this.anchor),e.map(this.head))}resolve(e){let o=e.resolve(this.anchor),n=e.resolve(this.head);return o.parent.type.spec.tableRole=="row"&&n.parent.type.spec.tableRole=="row"&&o.index()<o.parent.childCount&&n.index()<n.parent.childCount&&re(o,n)?new w(o,n):v.near(n,1)}};function rt(t){if(!(t.selection instanceof w))return null;let e=[];return t.selection.forEachCell((o,n)=>{e.push(I.node(n,n+o.nodeSize,{class:"selectedCell"}))}),L.create(t.doc,e)}function st({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let o=t.pos,n=e.pos,l=t.depth;for(;l>=0&&!(t.after(l+1)<t.end(l));l--,o++);for(let r=e.depth;r>=0&&!(e.before(r+1)>e.start(r));r--,n--);return o==n&&/row|table/.test(t.node(l).type.spec.tableRole)}function it({$from:t,$to:e}){let o,n;for(let l=t.depth;l>0;l--){let r=t.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){o=r;break}}for(let l=e.depth;l>0;l--){let r=e.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){n=r;break}}return o!==n&&e.parentOffset===0}function ct(t,e,o){let n=(e||t).selection,l=(e||t).doc,r,s;if(n instanceof pe&&(s=n.node.type.spec.tableRole)){if(s=="cell"||s=="header_cell")r=w.create(l,n.from);else if(s=="row"){let a=l.resolve(n.from+1);r=w.rowSelection(a,a)}else if(!o){let a=C.get(n.node),i=n.from+1,c=i+a.map[a.width*a.height-1];r=w.create(l,i+1,c)}}else n instanceof x&&st(n)?r=x.create(l,n.from):n instanceof x&&it(n)&&(r=x.create(l,n.$from.start(),n.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}var at=new W("fix-tables");function Ee(t,e,o,n){let l=t.childCount,r=e.childCount;e:for(let s=0,a=0;s<r;s++){let i=e.child(s);for(let c=a,d=Math.min(l,s+3);c<d;c++)if(t.child(c)==i){a=c+1,o+=i.nodeSize;continue e}n(i,o),a<l&&t.child(a).sameMarkup(i)?Ee(t.child(a),i,o+1,n):i.nodesBetween(0,i.content.size,n,o+1),o+=i.nodeSize}}function se(t,e){let o,n=(l,r)=>{l.type.spec.tableRole=="table"&&(o=dt(t,l,r,o))};return e?e.doc!=t.doc&&Ee(e.doc,t.doc,0,n):t.doc.descendants(n),o}function dt(t,e,o,n){let l=C.get(e);if(!l.problems)return n;n||(n=t.tr);let r=[];for(let i=0;i<l.height;i++)r.push(0);for(let i=0;i<l.problems.length;i++){let c=l.problems[i];if(c.type=="collision"){let d=e.nodeAt(c.pos);if(!d)continue;let f=d.attrs;for(let u=0;u<f.rowspan;u++)r[c.row+u]+=c.n;n.setNodeMarkup(n.mapping.map(o+1+c.pos),null,H(f,f.colspan-c.n,c.n))}else if(c.type=="missing")r[c.row]+=c.n;else if(c.type=="overlong_rowspan"){let d=e.nodeAt(c.pos);if(!d)continue;n.setNodeMarkup(n.mapping.map(o+1+c.pos),null,S(y({},d.attrs),{rowspan:d.attrs.rowspan-c.n}))}else if(c.type=="colwidth mismatch"){let d=e.nodeAt(c.pos);if(!d)continue;n.setNodeMarkup(n.mapping.map(o+1+c.pos),null,S(y({},d.attrs),{colwidth:c.colwidth}))}}let s,a;for(let i=0;i<r.length;i++)r[i]&&(s==null&&(s=i),a=i);for(let i=0,c=o+1;i<l.height;i++){let d=e.child(i),f=c+d.nodeSize,u=r[i];if(u>0){let h="cell";d.firstChild&&(h=d.firstChild.type.spec.tableRole);let p=[];for(let g=0;g<u;g++){let b=A(t.schema)[h].createAndFill();b&&p.push(b)}let m=(i==0||s==i-1)&&a==i?c+1:f-1;n.insert(n.mapping.map(m),p)}c=f}return n.setMeta(at,{fixTables:!0})}function ft(t){if(!t.size)return null;let{content:e,openStart:o,openEnd:n}=t;for(;e.childCount==1&&(o>0&&n>0||e.child(0).type.spec.tableRole=="table");)o--,n--,e=e.child(0).content;let l=e.child(0),r=l.type.spec.tableRole,s=l.type.schema,a=[];if(r=="row")for(let i=0;i<e.childCount;i++){let c=e.child(i).content,d=i?0:Math.max(0,o-1),f=i<e.childCount-1?0:Math.max(0,n-1);(d||f)&&(c=ne(A(s).row,new N(c,d,f)).content),a.push(c)}else if(r=="cell"||r=="header_cell")a.push(o||n?ne(A(s).row,new N(e,o,n)).content:e);else return null;return ut(s,a)}function ut(t,e){let o=[];for(let l=0;l<e.length;l++){let r=e[l];for(let s=r.childCount-1;s>=0;s--){let{rowspan:a,colspan:i}=r.child(s).attrs;for(let c=l;c<l+a;c++)o[c]=(o[c]||0)+i}}let n=0;for(let l=0;l<o.length;l++)n=Math.max(n,o[l]);for(let l=0;l<o.length;l++)if(l>=e.length&&e.push(R.empty),o[l]<n){let r=A(t).cell.createAndFill(),s=[];for(let a=o[l];a<n;a++)s.push(r);e[l]=e[l].append(R.from(s))}return{height:e.length,width:n,rows:e}}function ne(t,e){let o=t.createAndFill();return new ue(o).replace(0,o.content.size,e).doc}function ht({width:t,height:e,rows:o},n,l){if(t!=n){let r=[],s=[];for(let a=0;a<o.length;a++){let i=o[a],c=[];for(let d=r[a]||0,f=0;d<n;f++){let u=i.child(f%i.childCount);d+u.attrs.colspan>n&&(u=u.type.createChecked(H(u.attrs,u.attrs.colspan,d+u.attrs.colspan-n),u.content)),c.push(u),d+=u.attrs.colspan;for(let h=1;h<u.attrs.rowspan;h++)r[a+h]=(r[a+h]||0)+u.attrs.colspan}s.push(R.from(c))}o=s,t=n}if(e!=l){let r=[];for(let s=0,a=0;s<l;s++,a++){let i=[],c=o[a%e];for(let d=0;d<c.childCount;d++){let f=c.child(d);s+f.attrs.rowspan>l&&(f=f.type.create(S(y({},f.attrs),{rowspan:Math.max(1,l-f.attrs.rowspan)}),f.content)),i.push(f)}r.push(R.from(i))}o=r,e=l}return{width:t,height:e,rows:o}}function pt(t,e,o,n,l,r,s){let a=t.doc.type.schema,i=A(a),c,d;if(l>e.width)for(let f=0,u=0;f<e.height;f++){let h=o.child(f);u+=h.nodeSize;let p=[],m;h.lastChild==null||h.lastChild.type==i.cell?m=c||(c=i.cell.createAndFill()):m=d||(d=i.header_cell.createAndFill());for(let g=e.width;g<l;g++)p.push(m);t.insert(t.mapping.slice(s).map(u-1+n),p)}if(r>e.height){let f=[];for(let p=0,m=(e.height-1)*e.width;p<Math.max(e.width,l);p++){let g=p>=e.width?!1:o.nodeAt(e.map[m+p]).type==i.header_cell;f.push(g?d||(d=i.header_cell.createAndFill()):c||(c=i.cell.createAndFill()))}let u=i.row.create(null,R.from(f)),h=[];for(let p=e.height;p<r;p++)h.push(u);t.insert(t.mapping.slice(s).map(n+o.nodeSize-2),h)}return!!(c||d)}function ye(t,e,o,n,l,r,s,a){if(s==0||s==e.height)return!1;let i=!1;for(let c=l;c<r;c++){let d=s*e.width+c,f=e.map[d];if(e.map[d-e.width]==f){i=!0;let u=o.nodeAt(f),{top:h,left:p}=e.findCell(f);t.setNodeMarkup(t.mapping.slice(a).map(f+n),null,S(y({},u.attrs),{rowspan:s-h})),t.insert(t.mapping.slice(a).map(e.positionAt(s,p,o)),u.type.createAndFill(S(y({},u.attrs),{rowspan:h+u.attrs.rowspan-s}))),c+=u.attrs.colspan-1}}return i}function Se(t,e,o,n,l,r,s,a){if(s==0||s==e.width)return!1;let i=!1;for(let c=l;c<r;c++){let d=c*e.width+s,f=e.map[d];if(e.map[d-1]==f){i=!0;let u=o.nodeAt(f),h=e.colCount(f),p=t.mapping.slice(a).map(f+n);t.setNodeMarkup(p,null,H(u.attrs,s-h,u.attrs.colspan-(s-h))),t.insert(p+u.nodeSize,u.type.createAndFill(H(u.attrs,0,s-h))),c+=u.attrs.rowspan-1}}return i}function Ae(t,e,o,n,l){let r=o?t.doc.nodeAt(o-1):t.doc;if(!r)throw new Error("No table found");let s=C.get(r),{top:a,left:i}=n,c=i+l.width,d=a+l.height,f=t.tr,u=0;function h(){if(r=o?f.doc.nodeAt(o-1):f.doc,!r)throw new Error("No table found");s=C.get(r),u=f.mapping.maps.length}pt(f,s,r,o,c,d,u)&&h(),ye(f,s,r,o,i,c,a,u)&&h(),ye(f,s,r,o,i,c,d,u)&&h(),Se(f,s,r,o,a,d,i,u)&&h(),Se(f,s,r,o,a,d,c,u)&&h();for(let p=a;p<d;p++){let m=s.positionAt(p,i,r),g=s.positionAt(p,c,r);f.replace(f.mapping.slice(u).map(m+o),f.mapping.slice(u).map(g+o),new N(l.rows[p-a],0,0))}h(),f.setSelection(new w(f.doc.resolve(o+s.positionAt(a,i,r)),f.doc.resolve(o+s.positionAt(d-1,c-1,r)))),e(f)}var mt=me({ArrowLeft:K("horiz",-1),ArrowRight:K("horiz",1),ArrowUp:K("vert",-1),ArrowDown:K("vert",1),"Shift-ArrowLeft":V("horiz",-1),"Shift-ArrowRight":V("horiz",1),"Shift-ArrowUp":V("vert",-1),"Shift-ArrowDown":V("vert",1),Backspace:X,"Mod-Backspace":X,Delete:X,"Mod-Delete":X});function q(t,e,o){return o.eq(t.selection)?!1:(e&&e(t.tr.setSelection(o).scrollIntoView()),!0)}function K(t,e){return(o,n,l)=>{if(!l)return!1;let r=o.selection;if(r instanceof w)return q(o,n,v.near(r.$headCell,e));if(t!="horiz"&&!r.empty)return!1;let s=De(l,t,e);if(s==null)return!1;if(t=="horiz")return q(o,n,v.near(o.doc.resolve(r.head+e),e));{let a=o.doc.resolve(s),i=Te(a,t,e),c;return i?c=v.near(i,1):e<0?c=v.near(o.doc.resolve(a.before(-1)),-1):c=v.near(o.doc.resolve(a.after(-1)),1),q(o,n,c)}}}function V(t,e){return(o,n,l)=>{if(!l)return!1;let r=o.selection,s;if(r instanceof w)s=r;else{let i=De(l,t,e);if(i==null)return!1;s=new w(o.doc.resolve(i))}let a=Te(s.$headCell,t,e);return a?q(o,n,new w(s.$anchorCell,a)):!1}}function X(t,e){let o=t.selection;if(!(o instanceof w))return!1;if(e){let n=t.tr,l=A(t.schema).cell.createAndFill().content;o.forEachCell((r,s)=>{r.content.eq(l)||n.replace(n.mapping.map(s+1),n.mapping.map(s+r.nodeSize-1),new N(l,0,0))}),n.docChanged&&e(n)}return!0}function gt(t,e){let o=t.state.doc,n=_(o.resolve(e));return n?(t.dispatch(t.state.tr.setSelection(new w(n))),!0):!1}function wt(t,e,o){if(!T(t.state))return!1;let n=ft(o),l=t.state.selection;if(l instanceof w){n||(n={width:1,height:1,rows:[R.from(ne(A(t.state.schema).cell,o))]});let r=l.$anchorCell.node(-1),s=l.$anchorCell.start(-1),a=C.get(r).rectBetween(l.$anchorCell.pos-s,l.$headCell.pos-s);return n=ht(n,a.right-a.left,a.bottom-a.top),Ae(t.state,t.dispatch,s,a,n),!0}else if(n){let r=U(t.state),s=r.start(-1);return Ae(t.state,t.dispatch,s,C.get(r.node(-1)).findCell(r.pos-s),n),!0}else return!1}function Ct(t,e){var o;if(e.ctrlKey||e.metaKey)return;let n=Re(t,e.target),l;if(e.shiftKey&&t.state.selection instanceof w)r(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&(l=_(t.state.selection.$anchor))!=null&&((o=Z(t,e))==null?void 0:o.pos)!=l.pos)r(l,e),e.preventDefault();else if(!n)return;function r(i,c){let d=Z(t,c),f=E.getState(t.state)==null;if(!d||!re(i,d))if(f)d=i;else return;let u=new w(i,d);if(f||!t.state.selection.eq(u)){let h=t.state.tr.setSelection(u);f&&h.setMeta(E,i.pos),t.dispatch(h)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",a),E.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(E,-1))}function a(i){let c=i,d=E.getState(t.state),f;if(d!=null)f=t.state.doc.resolve(d);else if(Re(t,c.target)!=n&&(f=Z(t,e),!f))return s();f&&r(f,c)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",a)}function De(t,e,o){if(!(t.state.selection instanceof x))return null;let{$head:n}=t.state.selection;for(let l=n.depth-1;l>=0;l--){let r=n.node(l);if((o<0?n.index(l):n.indexAfter(l))!=(o<0?0:r.childCount))return null;if(r.type.spec.tableRole=="cell"||r.type.spec.tableRole=="header_cell"){let a=n.before(l),i=e=="vert"?o>0?"down":"up":o>0?"right":"left";return t.endOfTextblock(i)?a:null}}return null}function Re(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function Z(t,e){let o=t.posAtCoords({left:e.clientX,top:e.clientY});return o&&o?_(t.state.doc.resolve(o.pos)):null}var bt=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),le(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!=this.node.type?!1:(this.node=t,le(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))}};function le(t,e,o,n,l,r){var s;let a=0,i=!0,c=e.firstChild,d=t.firstChild;if(d){for(let f=0,u=0;f<d.childCount;f++){let{colspan:h,colwidth:p}=d.child(f).attrs;for(let m=0;m<h;m++,u++){let g=l==u?r:p&&p[m],b=g?g+"px":"";a+=g||n,g||(i=!1),c?(c.style.width!=b&&(c.style.width=b),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=b}}for(;c;){let f=c.nextSibling;(s=c.parentNode)==null||s.removeChild(c),c=f}i?(o.style.width=a+"px",o.style.minWidth=""):(o.style.width="",o.style.minWidth=a+"px")}}var M=new W("tableColumnResizing");function He({handleWidth:t=5,cellMinWidth:e=25,View:o=bt,lastColumnResizable:n=!0}={}){let l=new $({key:M,state:{init(r,s){return l.spec.props.nodeViews[A(s.schema).table.name]=(a,i)=>new o(a,e,i),new yt(-1,!1)},apply(r,s){return s.apply(r)}},props:{attributes:r=>{let s=M.getState(r);return s&&s.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(r,s)=>{St(r,s,t,e,n)},mouseleave:r=>{At(r)},mousedown:(r,s)=>{Rt(r,s,e)}},decorations:r=>{let s=M.getState(r);if(s&&s.activeHandle>-1)return zt(r,s.activeHandle)},nodeViews:{}}});return l}var yt=class J{constructor(e,o){this.activeHandle=e,this.dragging=o}apply(e){let o=this,n=e.getMeta(M);if(n&&n.setHandle!=null)return new J(n.setHandle,!1);if(n&&n.setDragging!==void 0)return new J(o.activeHandle,n.setDragging);if(o.activeHandle>-1&&e.docChanged){let l=e.mapping.map(o.activeHandle,-1);return oe(e.doc.resolve(l))||(l=-1),new J(l,o.dragging)}return o}};function St(t,e,o,n,l){let r=M.getState(t.state);if(r&&!r.dragging){let s=Mt(e.target),a=-1;if(s){let{left:i,right:c}=s.getBoundingClientRect();e.clientX-i<=o?a=xe(t,e,"left",o):c-e.clientX<=o&&(a=xe(t,e,"right",o))}if(a!=r.activeHandle){if(!l&&a!==-1){let i=t.state.doc.resolve(a),c=i.node(-1),d=C.get(c),f=i.start(-1);if(d.colCount(i.pos-f)+i.nodeAfter.attrs.colspan-1==d.width-1)return}We(t,a)}}}function At(t){let e=M.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&We(t,-1)}function Rt(t,e,o){let n=M.getState(t.state);if(!n||n.activeHandle==-1||n.dragging)return!1;let l=t.state.doc.nodeAt(n.activeHandle),r=xt(t,n.activeHandle,l.attrs);t.dispatch(t.state.tr.setMeta(M,{setDragging:{startX:e.clientX,startWidth:r}}));function s(i){window.removeEventListener("mouseup",s),window.removeEventListener("mousemove",a);let c=M.getState(t.state);c!=null&&c.dragging&&(Nt(t,c.activeHandle,Me(c.dragging,i,o)),t.dispatch(t.state.tr.setMeta(M,{setDragging:null})))}function a(i){if(!i.which)return s(i);let c=M.getState(t.state);if(c&&c.dragging){let d=Me(c.dragging,i,o);vt(t,c.activeHandle,d,o)}}return window.addEventListener("mouseup",s),window.addEventListener("mousemove",a),e.preventDefault(),!0}function xt(t,e,{colspan:o,colwidth:n}){let l=n&&n[n.length-1];if(l)return l;let r=t.domAtPos(e),a=r.node.childNodes[r.offset].offsetWidth,i=o;if(n)for(let c=0;c<o;c++)n[c]&&(a-=n[c],i--);return a/i}function Mt(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function xe(t,e,o,n){let l=o=="right"?-n:n,r=t.posAtCoords({left:e.clientX+l,top:e.clientY});if(!r)return-1;let{pos:s}=r,a=_(t.state.doc.resolve(s));if(!a)return-1;if(o=="right")return a.pos;let i=C.get(a.node(-1)),c=a.start(-1),d=i.map.indexOf(a.pos-c);return d%i.width==0?-1:c+i.map[d-1]}function Me(t,e,o){let n=e.clientX-t.startX;return Math.max(o,t.startWidth+n)}function We(t,e){t.dispatch(t.state.tr.setMeta(M,{setHandle:e}))}function Nt(t,e,o){let n=t.state.doc.resolve(e),l=n.node(-1),r=C.get(l),s=n.start(-1),a=r.colCount(n.pos-s)+n.nodeAfter.attrs.colspan-1,i=t.state.tr;for(let c=0;c<r.height;c++){let d=c*r.width+a;if(c&&r.map[d]==r.map[d-r.width])continue;let f=r.map[d],u=l.nodeAt(f).attrs,h=u.colspan==1?0:a-r.colCount(f);if(u.colwidth&&u.colwidth[h]==o)continue;let p=u.colwidth?u.colwidth.slice():Tt(u.colspan);p[h]=o,i.setNodeMarkup(s+f,null,S(y({},u),{colwidth:p}))}i.docChanged&&t.dispatch(i)}function vt(t,e,o,n){let l=t.state.doc.resolve(e),r=l.node(-1),s=l.start(-1),a=C.get(r).colCount(l.pos-s)+l.nodeAfter.attrs.colspan-1,i=t.domAtPos(l.start(-1)).node;for(;i&&i.nodeName!="TABLE";)i=i.parentNode;i&&le(r,i.firstChild,i,n,a,o)}function Tt(t){return Array(t).fill(0)}function zt(t,e){let o=[],n=t.doc.resolve(e),l=n.node(-1);if(!l)return L.empty;let r=C.get(l),s=n.start(-1),a=r.colCount(n.pos-s)+n.nodeAfter.attrs.colspan;for(let i=0;i<r.height;i++){let c=a+i*r.width-1;if((a==r.width||r.map[c]!=r.map[c+1])&&(i==0||r.map[c]!=r.map[c-r.width])){let d=r.map[c],f=s+d+l.nodeAt(d).nodeSize-1,u=document.createElement("div");u.className="column-resize-handle",o.push(I.widget(f,u))}}return L.create(t.doc,o)}function z(t){let e=t.selection,o=U(t),n=o.node(-1),l=o.start(-1),r=C.get(n),s=e instanceof w?r.rectBetween(e.$anchorCell.pos-l,e.$headCell.pos-l):r.findCell(o.pos-l);return S(y({},s),{tableStart:l,map:r,table:n})}function _e(t,{map:e,tableStart:o,table:n},l){let r=l>0?-1:0;nt(e,n,l+r)&&(r=l==0||l==e.width?null:0);for(let s=0;s<e.height;s++){let a=s*e.width+l;if(l>0&&l<e.width&&e.map[a-1]==e.map[a]){let i=e.map[a],c=n.nodeAt(i);t.setNodeMarkup(t.mapping.map(o+i),null,ze(c.attrs,l-e.colCount(i))),s+=c.attrs.rowspan-1}else{let i=r==null?A(n.type.schema).cell:n.nodeAt(e.map[a+r]).type,c=e.positionAt(s,l,n);t.insert(t.mapping.map(o+c),i.createAndFill())}}return t}function Be(t,e){if(!T(t))return!1;if(e){let o=z(t);e(_e(t.tr,o,o.left))}return!0}function Pe(t,e){if(!T(t))return!1;if(e){let o=z(t);e(_e(t.tr,o,o.right))}return!0}function kt(t,{map:e,table:o,tableStart:n},l){let r=t.mapping.maps.length;for(let s=0;s<e.height;){let a=s*e.width+l,i=e.map[a],c=o.nodeAt(i),d=c.attrs;if(l>0&&e.map[a-1]==i||l<e.width-1&&e.map[a+1]==i)t.setNodeMarkup(t.mapping.slice(r).map(n+i),null,H(d,l-e.colCount(i)));else{let f=t.mapping.slice(r).map(n+i);t.delete(f,f+c.nodeSize)}s+=d.rowspan}}function Fe(t,e){if(!T(t))return!1;if(e){let o=z(t),n=t.tr;if(o.left==0&&o.right==o.map.width)return!1;for(let l=o.right-1;kt(n,o,l),l!=o.left;l--){let r=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!r)throw RangeError("No table found");o.table=r,o.map=C.get(r)}e(n)}return!0}function Et(t,e,o){var n;let l=A(e.type.schema).header_cell;for(let r=0;r<t.width;r++)if(((n=e.nodeAt(t.map[r+o*t.width]))==null?void 0:n.type)!=l)return!1;return!0}function Le(t,{map:e,tableStart:o,table:n},l){var r;let s=o;for(let c=0;c<l;c++)s+=n.child(c).nodeSize;let a=[],i=l>0?-1:0;Et(e,n,l+i)&&(i=l==0||l==e.height?null:0);for(let c=0,d=e.width*l;c<e.width;c++,d++)if(l>0&&l<e.height&&e.map[d]==e.map[d-e.width]){let f=e.map[d],u=n.nodeAt(f).attrs;t.setNodeMarkup(o+f,null,S(y({},u),{rowspan:u.rowspan+1})),c+=u.colspan-1}else{let f=i==null?A(n.type.schema).cell:(r=n.nodeAt(e.map[d+i*e.width]))==null?void 0:r.type,u=f==null?void 0:f.createAndFill();u&&a.push(u)}return t.insert(s,A(n.type.schema).row.create(null,a)),t}function Oe(t,e){if(!T(t))return!1;if(e){let o=z(t);e(Le(t.tr,o,o.top))}return!0}function $e(t,e){if(!T(t))return!1;if(e){let o=z(t);e(Le(t.tr,o,o.bottom))}return!0}function Dt(t,{map:e,table:o,tableStart:n},l){let r=0;for(let c=0;c<l;c++)r+=o.child(c).nodeSize;let s=r+o.child(l).nodeSize,a=t.mapping.maps.length;t.delete(r+n,s+n);let i=new Set;for(let c=0,d=l*e.width;c<e.width;c++,d++){let f=e.map[d];if(!i.has(f)){if(i.add(f),l>0&&f==e.map[d-e.width]){let u=o.nodeAt(f).attrs;t.setNodeMarkup(t.mapping.slice(a).map(f+n),null,S(y({},u),{rowspan:u.rowspan-1})),c+=u.colspan-1}else if(l<e.height&&f==e.map[d+e.width]){let u=o.nodeAt(f),h=u.attrs,p=u.type.create(S(y({},h),{rowspan:u.attrs.rowspan-1}),u.content),m=e.positionAt(l+1,c,o);t.insert(t.mapping.slice(a).map(n+m),p),c+=h.colspan-1}}}}function Ie(t,e){if(!T(t))return!1;if(e){let o=z(t),n=t.tr;if(o.top==0&&o.bottom==o.map.height)return!1;for(let l=o.bottom-1;Dt(n,o,l),l!=o.top;l--){let r=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!r)throw RangeError("No table found");o.table=r,o.map=C.get(o.table)}e(n)}return!0}function Ne(t){let e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Ht({width:t,height:e,map:o},n){let l=n.top*t+n.left,r=l,s=(n.bottom-1)*t+n.left,a=l+(n.right-n.left-1);for(let i=n.top;i<n.bottom;i++){if(n.left>0&&o[r]==o[r-1]||n.right<t&&o[a]==o[a+1])return!0;r+=t,a+=t}for(let i=n.left;i<n.right;i++){if(n.top>0&&o[l]==o[l-t]||n.bottom<e&&o[s]==o[s+t])return!0;l++,s++}return!1}function ie(t,e){let o=t.selection;if(!(o instanceof w)||o.$anchorCell.pos==o.$headCell.pos)return!1;let n=z(t),{map:l}=n;if(Ht(l,n))return!1;if(e){let r=t.tr,s={},a=R.empty,i,c;for(let d=n.top;d<n.bottom;d++)for(let f=n.left;f<n.right;f++){let u=l.map[d*l.width+f],h=n.table.nodeAt(u);if(!(s[u]||!h))if(s[u]=!0,i==null)i=u,c=h;else{Ne(h)||(a=a.append(h.content));let p=r.mapping.map(u+n.tableStart);r.delete(p,p+h.nodeSize)}}if(i==null||c==null)return!0;if(r.setNodeMarkup(i+n.tableStart,null,S(y({},ze(c.attrs,c.attrs.colspan,n.right-n.left-c.attrs.colspan)),{rowspan:n.bottom-n.top})),a.size){let d=i+1+c.content.size,f=Ne(c)?i+1:d;r.replaceWith(f+n.tableStart,d+n.tableStart,a)}r.setSelection(new w(r.doc.resolve(i+n.tableStart))),e(r)}return!0}function ce(t,e){let o=A(t.schema);return Wt(({node:n})=>o[n.type.spec.tableRole])(t,e)}function Wt(t){return(e,o)=>{var n;let l=e.selection,r,s;if(l instanceof w){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,s=l.$anchorCell.pos}else{if(r=et(l.$from),!r)return!1;s=(n=_(l.$from))==null?void 0:n.pos}if(r==null||s==null||r.attrs.colspan==1&&r.attrs.rowspan==1)return!1;if(o){let a=r.attrs,i=[],c=a.colwidth;a.rowspan>1&&(a=S(y({},a),{rowspan:1})),a.colspan>1&&(a=S(y({},a),{colspan:1}));let d=z(e),f=e.tr;for(let h=0;h<d.right-d.left;h++)i.push(c?S(y({},a),{colwidth:c&&c[h]?[c[h]]:null}):a);let u;for(let h=d.top;h<d.bottom;h++){let p=d.map.positionAt(h,d.left,d.table);h==d.top&&(p+=r.nodeSize);for(let m=d.left,g=0;m<d.right;m++,g++)m==d.left&&h==d.top||f.insert(u=f.mapping.map(p+d.tableStart,1),t({node:r,row:h,col:m}).createAndFill(i[g]))}f.setNodeMarkup(s,t({node:r,row:d.top,col:d.left}),i[0]),l instanceof w&&f.setSelection(new w(f.doc.resolve(l.$anchorCell.pos),u?f.doc.resolve(u):void 0)),o(f)}return!0}}function je(t,e){return function(o,n){if(!T(o))return!1;let l=U(o);if(l.nodeAfter.attrs[t]===e)return!1;if(n){let r=o.tr;o.selection instanceof w?o.selection.forEachCell((s,a)=>{s.attrs[t]!==e&&r.setNodeMarkup(a,null,S(y({},s.attrs),{[t]:e}))}):r.setNodeMarkup(l.pos,null,S(y({},l.nodeAfter.attrs),{[t]:e})),n(r)}return!0}}function _t(t){return function(e,o){if(!T(e))return!1;if(o){let n=A(e.schema),l=z(e),r=e.tr,s=l.map.cellsInRect(t=="column"?{left:l.left,top:0,right:l.right,bottom:l.map.height}:t=="row"?{left:0,top:l.top,right:l.map.width,bottom:l.bottom}:l),a=s.map(i=>l.table.nodeAt(i));for(let i=0;i<s.length;i++)a[i].type==n.header_cell&&r.setNodeMarkup(l.tableStart+s[i],n.cell,a[i].attrs);if(r.steps.length==0)for(let i=0;i<s.length;i++)r.setNodeMarkup(l.tableStart+s[i],n.header_cell,a[i].attrs);o(r)}return!0}}function ve(t,e,o){let n=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let l=0;l<n.length;l++){let r=e.table.nodeAt(n[l]);if(r&&r.type!==o.header_cell)return!1}return!0}function B(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?_t(t):function(o,n){if(!T(o))return!1;if(n){let l=A(o.schema),r=z(o),s=o.tr,a=ve("row",r,l),i=ve("column",r,l),d=(t==="column"?a:t==="row"?i:!1)?1:0,f=t=="column"?{left:0,top:d,right:1,bottom:r.map.height}:t=="row"?{left:d,top:0,right:r.map.width,bottom:1}:r,u=t=="column"?i?l.cell:l.header_cell:t=="row"?a?l.cell:l.header_cell:l.cell;r.map.cellsInRect(f).forEach(h=>{let p=h+r.tableStart,m=s.doc.nodeAt(p);m&&s.setNodeMarkup(p,u,m.attrs)}),n(s)}return!0}}var to=B("row",{useDeprecatedLogic:!0}),oo=B("column",{useDeprecatedLogic:!0}),Ke=B("cell",{useDeprecatedLogic:!0});function Bt(t,e){if(e<0){let o=t.nodeBefore;if(o)return t.pos-o.nodeSize;for(let n=t.index(-1)-1,l=t.before();n>=0;n--){let r=t.node(-1).child(n),s=r.lastChild;if(s)return l-1-s.nodeSize;l-=r.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;let o=t.node(-1);for(let n=t.indexAfter(-1),l=t.after();n<o.childCount;n++){let r=o.child(n);if(r.childCount)return l+1;l+=r.nodeSize}}return null}function ae(t){return function(e,o){if(!T(e))return!1;let n=Bt(U(e),t);if(n==null)return!1;if(o){let l=e.doc.resolve(n);o(e.tr.setSelection(x.between(l,ot(l))).scrollIntoView())}return!0}}function Ve(t,e){let o=t.selection.$anchor;for(let n=o.depth;n>0;n--)if(o.node(n).type.spec.tableRole=="table")return e&&e(t.tr.delete(o.before(n),o.after(n)).scrollIntoView()),!0;return!1}function Xe({allowTableNodeSelection:t=!1}={}){return new $({key:E,state:{init(){return null},apply(e,o){let n=e.getMeta(E);if(n!=null)return n==-1?null:n;if(o==null||!e.docChanged)return o;let{deleted:l,pos:r}=e.mapping.mapResult(o);return l?null:r}},props:{decorations:rt,handleDOMEvents:{mousedown:Ct},createSelectionBetween(e){return E.getState(e.state)!=null?e.state.selection:null},handleTripleClick:gt,handleKeyDown:mt,handlePaste:wt},appendTransaction(e,o,n){return ct(n,se(n,o),t)}})}function qe(t,e,o,n,l,r){let s=0,a=!0,i=e.firstChild,c=t.firstChild;for(let d=0,f=0;d<c.childCount;d+=1){let{colspan:u,colwidth:h}=c.child(d).attrs;for(let p=0;p<u;p+=1,f+=1){let m=l===f?r:h&&h[p],g=m?`${m}px`:"";s+=m||n,m||(a=!1),i?(i.style.width!==g&&(i.style.width=g),i=i.nextSibling):e.appendChild(document.createElement("col")).style.width=g}}for(;i;){let d=i.nextSibling;i.parentNode.removeChild(i),i=d}a?(o.style.width=`${s}px`,o.style.minWidth=""):(o.style.width="",o.style.minWidth=`${s}px`)}var de=class{constructor(e,o){this.node=e,this.cellMinWidth=o,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),qe(e,this.colgroup,this.table,o),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,qe(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}};function Je(t,e){return e?t.createChecked(null,e):t.createAndFill()}function Pt(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;let e={};return Object.keys(t.nodes).forEach(o=>{let n=t.nodes[o];n.spec.tableRole&&(e[n.spec.tableRole]=n)}),t.cached.tableNodeTypes=e,e}function Ft(t,e,o,n,l){let r=Pt(t),s=[],a=[];for(let c=0;c<o;c+=1){let d=Je(r.cell,l);if(d&&a.push(d),n){let f=Je(r.header_cell,l);f&&s.push(f)}}let i=[];for(let c=0;c<e;c+=1)i.push(r.row.createChecked(null,n&&c===0?s:a));return r.table.createChecked(null,i)}function Lt(t){return t instanceof w}var Y=({editor:t})=>{let{selection:e}=t.state;if(!Lt(e))return!1;let o=0,n=Ce(e.ranges[0].$from,r=>r.type.name==="table");return n==null||n.node.descendants(r=>{if(r.type.name==="table")return!1;["tableCell","tableHeader"].includes(r.type.name)&&(o+=1)}),o===e.ranges.length?(t.commands.deleteTable(),!0):!1},Ue=be.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:de,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",j(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:o=!0}={})=>({tr:n,dispatch:l,editor:r})=>{let s=Ft(r.schema,t,e,o);if(l){let a=n.selection.anchor+1;n.replaceSelectionWith(s).scrollIntoView().setSelection(x.near(n.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Be(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Pe(t,e),deleteColumn:()=>({state:t,dispatch:e})=>Fe(t,e),addRowBefore:()=>({state:t,dispatch:e})=>Oe(t,e),addRowAfter:()=>({state:t,dispatch:e})=>$e(t,e),deleteRow:()=>({state:t,dispatch:e})=>Ie(t,e),deleteTable:()=>({state:t,dispatch:e})=>Ve(t,e),mergeCells:()=>({state:t,dispatch:e})=>ie(t,e),splitCell:()=>({state:t,dispatch:e})=>ce(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>B("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>B("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>Ke(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>ie(t,e)?!0:ce(t,e),setCellAttribute:(t,e)=>({state:o,dispatch:n})=>je(t,e)(o,n),goToNextCell:()=>({state:t,dispatch:e})=>ae(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>ae(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&se(t),!0),setCellSelection:t=>({tr:e,dispatch:o})=>{if(o){let n=w.create(e.doc,t.anchorCell,t.headCell);e.setSelection(n)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Y,"Mod-Backspace":Y,Delete:Y,"Mod-Delete":Y}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[He({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Xe({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){let e={name:t.name,options:t.options,storage:t.storage};return{tableRole:we(ge(t,"tableRole",e))}}});var go=Ue.extend({renderHTML({node:t,HTMLAttributes:e}){var o,n;let l=0,r=!0;try{let s=((o=t.content)===null||o===void 0?void 0:o.content)[0];(n=s==null?void 0:s.content)===null||n===void 0||n.content.forEach(a=>{if(a.attrs.colwidth)a.attrs.colwidth.forEach(i=>{i?l+=i:(r=!1,l+=this.options.cellMinWidth)});else{r=!1;let i=a.attrs.colspan||1;l+=this.options.cellMinWidth*i}})}catch{r=!1}return r&&l>0?e.style=`width: ${l}px;`:l&&l>0?e.style=`min-width: ${l}px`:e.style=null,["div",{class:"tui-table-wrapper"},["table",j(this.options.HTMLAttributes,e),["tbody",0]]]}});export{go as TuiTable};
//# sourceMappingURL=chunk-4TB5QD4Q.js.map
