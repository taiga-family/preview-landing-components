{"version":3,"sources":["node_modules/@tinkoff/tui-editor/fesm2015/tinkoff-tui-editor-extensions-details.js"],"sourcesContent":["import { TUI_EDITOR_RESIZE_EVENT } from '@tinkoff/tui-editor/constants';\nimport { tuiGetSelectedContent, tuiDeleteNode } from '@tinkoff/tui-editor/utils';\nimport { Node, mergeAttributes } from '@tiptap/core';\nconst TuiDetails = Node.create({\n  name: `details`,\n  addOptions() {\n    return {\n      HTMLAttributes: {}\n    };\n  },\n  addAttributes() {\n    return {\n      opened: {\n        default: true,\n        keepOnSplit: false,\n        parseHTML: element => element.getAttribute(`data-opened`) === `true`,\n        renderHTML: attributes => ({\n          'data-opened': attributes.opened\n        })\n      }\n    };\n  },\n  content: `summary detailsContent`,\n  group: `block`,\n  draggable: true,\n  allowGapCursor: true,\n  isolating: true,\n  parseHTML() {\n    return [{\n      tag: `details`\n    }];\n  },\n  renderHTML({\n    HTMLAttributes\n  }) {\n    return [`div`, {\n      class: `t-details-wrapper t-details-wrapper_rendered`\n    }, [`details`, mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0], [`button`, {\n      class: `t-details-arrow`\n    }]];\n  },\n  addNodeView() {\n    return ({\n      node,\n      getPos\n    }) => {\n      if (globalThis.document) {\n        const wrapper = document.createElement(`div`);\n        const details = document.createElement(`details`);\n        const collapseButton = document.createElement(`button`);\n        const deleteButton = document.createElement(`button`);\n        wrapper.className = `t-details-wrapper`;\n        collapseButton.className = `t-details-arrow`;\n        collapseButton.type = `button`;\n        deleteButton.className = `t-details-delete`;\n        deleteButton.type = `button`;\n        details.open = node.attrs.opened;\n        const openHandler = event => {\n          var _a, _b, _c;\n          const pos = (_b = (_a = getPos) === null || _a === void 0 ? void 0 : _a()) !== null && _b !== void 0 ? _b : 0;\n          details.open = !details.open;\n          node.attrs.opened = details.open;\n          (_c = event.target) === null || _c === void 0 ? void 0 : _c.dispatchEvent(new CustomEvent(TUI_EDITOR_RESIZE_EVENT, {\n            bubbles: true\n          }));\n          this.editor.chain().focus().setTextSelection(pos).run();\n        };\n        collapseButton.addEventListener(`click`, openHandler);\n        deleteButton.addEventListener(`click`, e => {\n          var _a, _b, _c, _d;\n          collapseButton.removeEventListener(`click`, openHandler);\n          const from = (_b = (_a = getPos) === null || _a === void 0 ? void 0 : _a()) !== null && _b !== void 0 ? _b : 0;\n          this.editor.chain().focus().setTextSelection((_c = getPos) === null || _c === void 0 ? void 0 : _c()).run();\n          const node = this.editor.state.selection.$anchor.nodeAfter;\n          const to = from + ((_d = node === null || node === void 0 ? void 0 : node.nodeSize) !== null && _d !== void 0 ? _d : 0);\n          if (this.editor.isActive(`summary`)) {\n            this.editor.commands.deleteNode(this.type);\n          } else {\n            this.editor.commands.deleteRange({\n              from,\n              to\n            });\n          }\n          e.preventDefault();\n        }, {\n          capture: true,\n          once: true\n        });\n        wrapper.append(details, collapseButton, deleteButton);\n        return {\n          dom: wrapper,\n          contentDOM: details\n        };\n      }\n    };\n  },\n  addCommands() {\n    return {\n      setDetails: () => ({\n        commands,\n        editor,\n        state\n      }) => {\n        var _a, _b, _c;\n        let content = ``;\n        const pos = this.editor.state.selection.$anchor.pos;\n        if (globalThis.document) {\n          content = ((_c = (_b = (_a = document.defaultView) === null || _a === void 0 ? void 0 : _a.window.getSelection()) === null || _b === void 0 ? void 0 : _b.toString().trim().length) !== null && _c !== void 0 ? _c : 0) > 0 ? tuiGetSelectedContent(state) : ``;\n          setTimeout(() => editor.chain().focus().setTextSelection(pos).run());\n        }\n        return commands.insertContent(`<details data-opened=\"true\"><summary><p></p></summary><div data-type=\"details-content\"><p>${content}</p></div></details><p></p>`);\n      },\n      removeDetails: () => ({\n        editor,\n        state,\n        dispatch\n      }) => {\n        tuiDeleteNode(state, dispatch, this.name);\n        return editor.commands.focus(`end`);\n      }\n    };\n  }\n});\nconst TuiDetailsContent = Node.create({\n  name: `detailsContent`,\n  content: `block+`,\n  group: `block`,\n  allowGapCursor: true,\n  parseHTML() {\n    return [{\n      tag: `div[data-type=\"details-content\"]`\n    }];\n  },\n  renderHTML({\n    HTMLAttributes\n  }) {\n    return [`div`, mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n      'data-type': `details-content`\n    }), 0];\n  }\n});\nconst TuiSummary = Node.create({\n  name: `summary`,\n  addOptions() {\n    return {\n      HTMLAttributes: {}\n    };\n  },\n  content: `paragraph`,\n  group: `block`,\n  parseHTML() {\n    return [{\n      tag: `summary`\n    }];\n  },\n  renderHTML({\n    HTMLAttributes\n  }) {\n    return [`summary`, mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0];\n  }\n});\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { TuiDetails, TuiDetailsContent, TuiSummary };\n"],"mappings":"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","names":["TuiDetails","Node","element","attributes","HTMLAttributes","mergeAttributes","node","getPos","wrapper","details","collapseButton","deleteButton","openHandler","event","_a","_b","_c","pos","TUI_EDITOR_RESIZE_EVENT","e","_d","from","to","commands","editor","state","content","tuiGetSelectedContent","dispatch","tuiDeleteNode","TuiDetailsContent","TuiSummary"],"x_google_ignoreList":[0]}