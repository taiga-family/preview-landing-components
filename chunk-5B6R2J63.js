import{Aa as oe,M,Na as de,Y as ne,cb as le,e as te}from"./chunk-2PB2LKF3.js";import{$b as x,Ab as g,Bb as _,Cb as I,Da as L,Ea as V,Ec as ee,Ga as R,Gb as Y,J as B,Ja as h,Jb as d,Ka as b,Kb as Z,Kc as w,Lb as J,Mb as K,Zb as F,ac as Q,ba as k,cb as G,eb as m,gb as p,hb as s,hd as j,ia as a,id as ie,ka as D,kb as X,nc as $,rb as f,ta as E,ua as u,va as l,vb as q,wb as A,xb as c,yb as v,yc as C,zb as y}from"./chunk-65QELWZL.js";import{B as O,Sa as se,Xa as ae,Ya as ue,q as re}from"./chunk-GOOAHOWT.js";var ce=(()=>{class t{constructor({nativeElement:e}){return new h(e)}}return t.\u0275fac=function(e){return new(e||t)(s(h))},t.\u0275dir=l({type:t,selectors:[["","tuiElement",""]],exportAs:["elementRef"]}),t})();var he=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({}),t})();var W=(()=>{class t extends ce{}return t.\u0275fac=(()=>{let n;return function(i){return(n||(n=R(t)))(i||t)}})(),t.\u0275dir=l({type:t,selectors:[["","tuiResizeable",""]],features:[f]}),t})(),me=(()=>{class t{constructor(e){this.resizeable=e,this.tuiResizer=[0,0],this.tuiSizeChange=new b,this.x=NaN,this.y=NaN,this.width=0,this.height=0}get cursor(){return this.tuiResizer[0]?this.tuiResizer[1]?this.tuiResizer[0]*this.tuiResizer[1]>0?"nwse-resize":"nesw-resize":"ew-resize":"ns-resize"}onTouchStart({touches:e}){this.onMouseDown(e[0].clientX,e[0].clientY)}onMouseDown(e,i){this.x=e,this.y=i,this.width=this.resizeable.nativeElement.clientWidth,this.height=this.resizeable.nativeElement.clientHeight}onMouseMove({x:e,y:i,buttons:o}){o?this.onMove(e,i):this.onMouseUp()}onTouchMove({touches:e}){this.onMove(e[0].clientX,e[0].clientY)}onMouseUp(){this.x=NaN}onMove(e,i){if(Number.isNaN(this.x))return;let{style:o}=this.resizeable.nativeElement,r=[this.width+this.tuiResizer[0]*(e-this.x),this.height+this.tuiResizer[1]*(i-this.y)];this.tuiResizer[0]&&(o.width=M(r[0])),this.tuiResizer[1]&&(o.height=M(r[1])),this.tuiSizeChange.emit(r)}}return t.\u0275fac=function(e){return new(e||t)(s(W))},t.\u0275dir=l({type:t,selectors:[["","tuiResizer",""]],hostVars:4,hostBindings:function(e,i){e&1&&d("touchstart.silent.passive",function(r){return i.onTouchStart(r)})("mousedown.silent.prevent",function(r){return i.onMouseDown(r.x,r.y)})("mousemove.silent",function(r){return i.onMouseMove(r)},!1,m)("touchmove.silent",function(r){return i.onTouchMove(r)},!1,m)("mouseup.silent",function(){return i.onMouseUp()},!1,m)("touchend.silent",function(){return i.onMouseUp()},!1,m),e&2&&v("touch-action","none")("cursor",i.cursor)},inputs:{tuiResizer:"tuiResizer"},outputs:{tuiSizeChange:"tuiSizeChange"}}),t})(),pe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({}),t})();var U=class{constructor(n,e,i){let o=e.get($),z=e.get(X).resolveComponentFactory(n);this.componentRef=z.create(e,[]),this.updateProps(i),o.attachView(this.componentRef.hostView)}get instance(){return this.componentRef.instance}get el(){return this.componentRef.injector.get(h)}get dom(){return this.el.nativeElement}updateProps(n){Object.entries(n).forEach(([e,i])=>{this.instance[e]=i})}detectChanges(){this.componentRef.changeDetectorRef.detectChanges()}destroy(){this.componentRef.destroy()}},H=class{},P=class extends ue{constructor(){super(...arguments),this.contentDOMElement=null}mount(){let n=this.options.injector,e=n.get(C),i={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(o={})=>this.updateAttributes(o),deleteNode:()=>this.deleteNode()};this.editor.on("selectionUpdate",this.handleSelectionUpdate.bind(this)),this.renderer=new U(this.component,n,i),this.extension.config.draggable&&(this.renderer.el.nativeElement.ondragstart=o=>{this.onDragStart(o)}),this.contentDOMElement=this.node.isLeaf?null:e.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit",this.renderer.detectChanges()),this.appendContendDom()}get dom(){return this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}update(n,e){return this.options.update?this.options.update(n,e):n.type!==this.node.type?!1:(n===this.node&&this.decorations===e||(this.node=n,this.decorations=e,this.renderer.updateProps({node:n,decorations:e}),this.appendContendDom()),!0)}handleSelectionUpdate(){let{from:n,to:e}=this.editor.state.selection;n<=this.getPos()&&e>=this.getPos()+this.node.nodeSize?this.selectNode():this.deselectNode()}selectNode(){this.renderer.updateProps({selected:!0})}deselectNode(){this.renderer.updateProps({selected:!1})}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate.bind(this)),this.contentDOMElement=null}appendContendDom(){let n=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&n&&!n.contains(this.contentDOMElement)&&n.appendChild(this.contentDOMElement)}};var De=["*"],Ee=t=>[t,0],Re=()=>[1,0],be=()=>[0,1];function ye(t,n){if(t&1){let e=Y();g(0,"div",4),d("tuiSizeChange",function(o){L(e);let r=Z();return V(r.sizeChange.emit(o))}),_()}t&2&&c("tuiResizer",x(1,be))}var ge=(()=>{class t extends H{constructor(){super(...arguments),this.currentHeight=0,this.currentWidth=0}get attrs(){var e;return((e=this.node)===null||e===void 0?void 0:e.attrs)||{src:""}}get width(){return this.currentWidth||this.attrs.width||null}get height(){return this.currentHeight||this.attrs.height||null}}return t.\u0275fac=(()=>{let n;return function(i){return(n||(n=R(t)))(i||t)}})(),t.\u0275dir=l({type:t,features:[f]}),t})(),fe=(()=>{class t{constructor(){this.autoHeight=!1,this.width=null,this.height=null,this.sizeChange=new b}get hostWidth(){return j(this.width)?M(this.width):this.width}get hostHeight(){return this.autoHeight?null:j(this.height)?M(this.height):this.height}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=E({type:t,selectors:[["tui-editor-resizable"]],hostVars:4,hostBindings:function(e,i){e&2&&v("width",i.hostWidth)("height",i.hostHeight)},inputs:{autoHeight:"autoHeight",width:"width",height:"height"},outputs:{sizeChange:"sizeChange"},ngContentSelectors:De,decls:5,vars:8,consts:[["tuiResizeable","",1,"t-resizable"],[1,"t-handle","t-handle-left-side",3,"tuiSizeChange","tuiResizer"],["class","t-handle t-handle-bottom-side",3,"tuiResizer","tuiSizeChange",4,"ngIf"],[1,"t-handle","t-handle-right-side",3,"tuiSizeChange","tuiResizer"],[1,"t-handle","t-handle-bottom-side",3,"tuiSizeChange","tuiResizer"]],template:function(e,i){e&1&&(J(),g(0,"div",0),K(1),g(2,"div",1),d("tuiSizeChange",function(r){return i.sizeChange.emit(r)}),_(),q(3,ye,1,2,"div",2),g(4,"div",3),d("tuiSizeChange",function(r){return i.sizeChange.emit(r)}),_()()),e&2&&(y("t-resizable-auto-height",i.autoHeight),p(2),c("tuiResizer",Q(5,Ee,-1)),p(),c("ngIf",!i.autoHeight),p(),c("tuiResizer",x(7,Re)))},dependencies:[W,me,ee],styles:['[_nghost-%COMP%]{position:relative;display:inline-block;box-sizing:border-box}[_nghost-%COMP%]   .t-resizable[_ngcontent-%COMP%]{box-sizing:border-box}[_nghost-%COMP%]   .t-resizable-auto-height[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   iframe[_ngcontent-%COMP%]{display:inline;pointer-events:none}[_nghost-%COMP%]:hover   .t-handle[_ngcontent-%COMP%]:after{opacity:1}.t-handle[_ngcontent-%COMP%]{position:absolute;top:0;display:flex;width:.75rem;cursor:col-resize;justify-content:center;align-items:center;height:100%}.t-handle[_ngcontent-%COMP%]:after{transition-property:opacity;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;content:"";width:50%;height:33%;box-sizing:border-box;border-radius:var(--tui-radius-m);background:var(--tui-base-08);border:1px solid var(--tui-base-03);opacity:0}.t-handle-left-side[_ngcontent-%COMP%]{left:0}.t-handle-bottom-side[_ngcontent-%COMP%]{top:unset;bottom:.3125rem;height:.95rem;width:100%}.t-handle-right-side[_ngcontent-%COMP%]{right:0}'],changeDetection:0}),t})(),ve=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({imports:[[w,he,pe]]}),t})();var Ce=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,_e=ae.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",O(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:n})=>n.insertContent({type:this.name,attrs:t})}},addInputRules(){return[se({find:Ce,type:this.type,getAttributes:t=>{let[,,n,e,i]=t;return{src:e,alt:n,title:i}}})]}});var we=new D("[TUI_EDITOR_MIN_IMAGE_WIDTH]",{factory:()=>null}),Oe=new D("[TUI_EDITOR_MAX_IMAGE_WIDTH]",{factory:()=>null}),Se=new D("[TUI_IMAGE_EDITOR_OPTIONS]",{factory:()=>({minWidth:null,maxWidth:1/0})}),He=(()=>{class t extends ge{constructor(e,i,o,r,z,T,N){super(),this.legacyMinWidth=e,this.legacyMaxWidth=i,this.options=o,this.doc=r,this.sanitizer=z,this.el=T,this.win=N,this.contenteditable=!0,this.focused=!1}get dragHandle(){var e;return(e=this.attrs.draggable)!==null&&e!==void 0?e:null}get height(){return null}get alt(){return this.attrs.alt||""}get title(){return this.attrs.title||""}get src(){return this.sanitizer.bypassSecurityTrustResourceUrl(this.attrs.src)}currentTargetIsFocused(e){this.focused=this.el.nativeElement.contains(e),this.focused&&this.selectFakeText()}get minWidth(){var e;return((e=this.legacyMinWidth)!==null&&e!==void 0?e:this.options.minWidth)||0}get maxWidth(){var e;return((e=this.legacyMaxWidth)!==null&&e!==void 0?e:this.options.maxWidth)||0}updateSize([e]){this.currentWidth=Math.max(this.minWidth,Math.min(this.maxWidth,e)),this.attrs.width=this.currentWidth,this.el.nativeElement.dispatchEvent(new CustomEvent(de,{bubbles:!0}))}selectFakeText(){var e,i,o;let r=this.doc.createRange();(e=this.el.nativeElement.querySelector("p"))===null||e===void 0||e.focus(),r.selectNode(this.el.nativeElement),(i=this.win.getSelection())===null||i===void 0||i.removeAllRanges(),(o=this.win.getSelection())===null||o===void 0||o.addRange(r)}}return t.\u0275fac=function(e){return new(e||t)(s(we),s(Oe),s(Se),s(C),s(te),s(h),s(ne))},t.\u0275cmp=E({type:t,selectors:[["tui-image-editor"]],hostVars:2,hostBindings:function(e,i){e&1&&d("click.silent",function(r){return i.currentTargetIsFocused(r.target)},!1,m),e&2&&A("contenteditable",i.contenteditable)("data-drag-handle",i.dragHandle)},features:[F([oe]),f],decls:4,vars:12,consts:[["contenteditable","false",1,"t-emulate-inline-node"],[3,"sizeChange","autoHeight","width"],["contenteditable","false",3,"alt","src","title"]],template:function(e,i){e&1&&(I(0,"p",0),g(1,"tui-editor-resizable",1),d("sizeChange",function(r){return i.updateSize(r)}),I(2,"img",2),_(),I(3,"p",0)),e&2&&(p(),c("autoHeight",!0)("width",i.width),p(),v("max-width",i.maxWidth,"px")("min-width",i.minWidth,"px"),y("ProseMirror-selectednode",i.focused),c("alt",i.alt)("src",i.src,G)("title",i.title),A("width",i.width))},dependencies:[fe],styles:["[data-drag-handle][_nghost-%COMP%]{cursor:move}img[_ngcontent-%COMP%]{pointer-events:none}.t-emulate-inline-node[_ngcontent-%COMP%]{display:inline-block;margin:0;height:0}"],changeDetection:0}),t})(),Pe=[{tag:"img"}],Ne={src:{default:"",keepOnSplit:!1},width:{default:null,keepOnSplit:!1},alt:{default:"",keepOnSplit:!1},title:{default:"",keepOnSplit:!1}};function Me(t){return(n,e)=>{var i;let o=e instanceof DragEvent?e.dataTransfer:e.clipboardData,r=Array.from((i=o==null?void 0:o.files)!==null&&i!==void 0?i:[]).filter(T=>/image/i.test(T.type));r.length&&e.preventDefault();let z=t.get(le);r.forEach(T=>{z(T).pipe(B(1),k(()=>!n.isDestroyed)).subscribe(N=>{let ze=n.state.schema.nodes.imageEditor.create({src:N}),Te=n.state.tr.replaceSelectionWith(ze);setTimeout==null||setTimeout(()=>{n.isDestroyed||n.dispatch(Te)})})})}}function xt({injector:t,draggable:n}){return Ae(t,{draggable:n})}function Ae(t,{draggable:n}={}){let e=ie(n)?n:!0;return _e.extend({name:"image",group:"inline",inline:!0,atom:!0,priority:0,selectable:!0,draggable:e,parseHTML(){return Pe},addAttributes(){return Object.assign(Object.assign({},Ne),{draggable:{default:e?"":null,keepOnSplit:!1}})},renderHTML({HTMLAttributes:i}){return["img",O(i)]},addNodeView(){return i=>Reflect.construct(P,[He,i,Object.assign({injector:t},i)])},addCommands(){return{setEditableImage:i=>({commands:o})=>o.insertContent({type:this.name,attrs:i})}},addProseMirrorPlugins(){return[new re({props:{handleDOMEvents:{paste:Me(t),drop:Me(t)}}})]}})}var jt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u({type:t}),t.\u0275inj=a({imports:[[w,ve]]}),t})();export{Oe as TUI_EDITOR_MAX_IMAGE_WIDTH,we as TUI_EDITOR_MIN_IMAGE_WIDTH,Se as TUI_IMAGE_EDITOR_OPTIONS,He as TuiImageEditorComponent,jt as TuiImageEditorModule,Ae as createImageEditorExtension,xt as tuiCreateImageEditorExtension};
//# sourceMappingURL=chunk-5B6R2J63.js.map
